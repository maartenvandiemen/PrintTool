name: Build Printtool
on: 
  push:
  workflow_dispatch:

env:
  DOTNET_SKIP_FIRST_TIME_EXPERIENCE: true
  #Specifies whether .NET welcome and telemetry messages are displayed on the first run.
  DOTNET_NOLOGO: true
  #Specifies whether to generate an ASP.NET Core certificate.
  DOTNET_GENERATE_ASPNET_CERTIFICATE: false

defaults:
  run:
    shell: pwsh
jobs:
  build_windows:
    runs-on: windows-latest
    env:
      NUGET_PACKAGES: '${{github.workspace}}/.nuget/packages'
    steps:  
    - uses: actions/checkout@v3    
    - uses: actions/setup-dotnet@v3
    - run: dotnet restore --locked-mode
    - run: dotnet build ${{github.workspace}}/PrintTool/PrintTool.csproj --no-restore -c Release -a x64
    - run: dotnet build ${{github.workspace}}/PrintTool.UnitTests/PrintTool.UnitTests.csproj --no-restore -c Release -a x64
    - run: dotnet publish ${{github.workspace}}/PrintTool/PrintTool.csproj -a x64 --output ${{github.workspace}}/artifacts/PrintToolWindows --no-restore -c Release --self-contained -p:PublishSingleFile=true -p:PublishTrimmed=true
    - uses: actions/upload-artifact@v3
      with:
        name: PrintToolWindows
        path: '${{github.workspace}}/artifacts/PrintToolWindows'
